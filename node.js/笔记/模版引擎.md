>2021.10.30

# 模版引擎

## 模版引擎的基础概念
模版引擎是第三方模块。   
让开发者以更友好的方式拼接字符串，使项目代码更加清晰、更加易于维护。
```javascript
//未用模版引擎的写法
var ary=[{
    name: 'lily',
    age: 20
}];
var str='<ul>';
for(var i=0;i<ary.length;i++){
    str+=
    '<li>\
        <span>'+ary[i].name+'</span>\
        <span>'+ary[i].age+'</span>\
    </li>';
}
str+='</ul>';
```
```html
<!-- 使用模版引擎的写法 -->
<ul>
    {{each ary}}
        <li>{{$value.name}}</li>
        <li>{{$value.age}}</li>
    {{/each}}
</ul>
```

## art-template模版引擎

- 在命令行工具中使用 `npm install art-template` 命令进行下载
- 使用 `const template = require('art-template')` 引入模版引擎
- 告诉模版引擎要拼接的数据和模版在哪 `const html = template('模版路径',数据);`

```javascript
//导入模版引擎
const template=require('art-template');
const path=require('path');//有join方法，可以拼接路径

//template方法是用来拼接字符串的
//  - 第一个参数：模版路径（绝对路径）
//  - 第二个参数：要在模版中显示的数据，是对象类型
//  - return：template方法返回拼接好的字符串
const viewsPath=path.join(__dirname,'views','index.art');
const html=template(viewsPath,{
    name: 'lily',
    age: 20
});
console.log(html);
```
```html
<!-- 模版 index.art 中的代码 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户列表</title>
</head>
<body>
    {{name}}
    {{age}}
</body>
</html>
```

## 模版引擎语法

art-template同时支持两种模版语法：**标准语法** 和 **原始语法**。   
标准语法可以让模版更容易读写，原始语法具有强大的逻辑处理能力。    

### 输出

#### 一般输出
将某项数据输出在模版中，标准语法和原始语法如下：
- 标准语法：{{数据}}
- 原始语法：<%=数据%>

#### 原文输出
如果数据中携带HTML标签，默认模版引擎不会解析标签，会将其转义后输出。
- 标准语法：{{@数据}}
- 原始语法：<%-数据%>

```html
<!-- views/01.art -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户列表</title>
</head>
<body>
    <!-- 标准语法 -->
    <p>{{name}}</p>
    <p>{{1+1}}</p>
    <p>{{1+1==2?'相等':'不相等'}}</p>
    <p>{{content}}</p>
    <p>{{@content}}</p>
    <!-- 原始语法 -->
    <p><%= name %></p>
    <p><%= 1+2 %></p>
    <p><%= 1+2==2?'相等':'不相等' %></p>
    <p><%= content %></p>
    <p><%- content %></p>
</body>
</html>
```
```javascript
//01.js
const template =require('art-template');
const path=require('path');

const viewsPath=path.join(__dirname,'views','01.art');

const html=template(viewsPath,{
    name: 'lily',
    age:18,
    content: '<h1>我是标题</h1>'
})

console.log(html);
```

### 条件判断
在模块中可以根据条件来决定显示哪块HTML代码  
```html
<!-- 标准语法 -->
{{if 条件}} ... {{/if}}
{{if v1}}
    ...
{{else if v2}}
    ...
{{/if}}
<!-- 原始语法 -->
<% if (value)>{%> ... <%} %>
<% if(v1){%>
    ... 
<%} else if(v2){%> 
    ... 
<% } %>
```

```html
<!-- views/02.art -->
{{if age>18}}
    年龄大于18
{{else if age<15}}
    年龄小于15
{{else}}
    年龄不符合要求
{{/if}}

<% if(age>18) { %>
    年龄大于18
<% } else if(age<15) { %>
    年龄小于15
<% } else { %>
    年龄不符合要求 
<% } %>
```
```javascript
//02.js
const template=require('art-template');
const path=require('path');

const viewsPath=path.join(__dirname,'views','02.art');

const html=template(viewsPath,{
    name: 'lily',
    age: 17,
})
console.log(html);
```

### 循环

对于数组里包裹对象的方式，我们通常都会用循环来展示数据。    
- 标准语法 {{each 数据}}{{/each}}
- 原始语法 <% for() {%><}%>

```html
<!-- 标准语法 -->
{{each target}}
    {{$index}}{{$value}}
{{/each}}
<!-- 原始语法 -->
<% for(var i=0;i<target.length;i++){%>
    <%= i %><%= target[i] %>
<% } %>
```
```html
<!-- views/03.art -->
<ul>
    {{each users}}
        <li>
            {{$value.name}}
            {{$value.age}}
            {{$value.sex}}
        </li>
    {{/each}}
</ul>

<ul>
    <% for(var i=0;i<users.length;i++){ %>
        <li>
            <%= users[i].name %>
            <%= users[i].age %>
            <%= users[i].sex %>
        </li>
    <% } %>
</ul>
```
```javascript
//03.js
const template=require('art-template')
const path=require('path')

const viewsPath=path.join(__dirname,'views','03.art')

const html=template(viewsPath,{
    users: [{
        name: 'lily',
        age: 20,
        sex: 'female'
    },{
        name: 'kitty',
        age: 30,
        sex: 'female'   
    },{
        name: 'jack',
        age: 15,
        sex: 'male'
    }]
})

console.log(html)
```

### 子模版

使用子模版可以将网站公共区块（头部、底部）抽离到单独的文件中。
- 标准语法：{{include '模版路径'}}
- 原始语法：<%include('模版')%>

```html
<!-- views/04.art -->
{{include './common/header.art'}}
<% include('./common/header.art')%>
<div>{{msg}}</div>
{{include './common/footer.art'}}
<% include('./common/footer.art')%>
```
```javascript
//04.js
const template=require('art-template')
const path=require('path')

const viewsPath=path.join(__dirname,'views','04.art')

const html=template(viewsPath,{
    msg: '我是首页'
})

console.log(html)
```

### 模版继承

使用模版继承可以将网站HTML骨架抽离到单独的文件中，其他页面模版可以继承骨架文件。

![继承](img/jicheng.jpg)

- 使用{{block 'xxx'}}{{/block}}去预留位置。
- 使用{{extend '路径'}}去继承模版 & {{block 'xxx'}} ... {{/block}}去填充。

```html
<!-- views/common/layout.art -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>模版继承</title>
    {{block 'link'}}{{/block}}
</head>
<body>
    {{block 'content'}}{{/block}}
</body>
</html>
```
```html
<!-- views/05.js -->
{{extend './common/layout.art'}}

{{block 'content'}}
    <p>{{msg}}</p>
{{/block}}

{{block 'link'}}
    <link rel="stylesheet" type="text/css" href="./main.css">
{{/block}}
```
```javascript
//05.js
const template=require('art-template')
const path=require('path')

const viewsPath=path.join(__dirname,'views','05.art')

const html=template(viewsPath,{
    msg: '首页模版'
})

console.log(html)
```

### 模版配置

1. 向模版中导入变量 `template.defaults.imports.变量名 = 变量值`;
   - 例如：dateformat模块 npm i dateformat@3.0.3
2. 设置模版根目录 `template.defaults.root = 模版目录`
3. 设置模版默认后缀 `template.defaults.extname = '.art'`

```html
<!-- views/06.art -->
{{time}} 
{{dateFormat(time,'yyyy-mm-dd')}} 
```
```html
<!-- views/07.html -->
我是07.html模版
```
```javascript
//06.js
const template=require('art-template');
const path=require('path');
const dateFormat=require('dateformat');

//设置模版的根目录
//const viewsPath=path.join(__dirname,'views','06.art')
template.defaults.root=path.join(__dirname,'views');

//导入模版变量 将dateFormate导入模版中
template.defaults.imports.dateFormat=dateFormat;

//配置模版的默认后缀
//template.defaults.extname='.art';
template.defaults.extname='.html'
//const html=template(viewsPath,{
//const html=template('06.art',{
//const html=template('06',{
const html=template('06.art',{
    time: new Date()
})

console.log(template('07',{}));

console.log(html)
```

